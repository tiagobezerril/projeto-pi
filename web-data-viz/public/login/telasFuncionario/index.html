<!-- Visão geral da dash -->
<!DOCTYPE html>
<html lang="pt-br">

<head>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:ital,opsz,wght@0,14..32,100..900;1,14..32,100..900&display=swap" rel="stylesheet">

    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>SafeWare | Visão geral</title>

    <link rel="shortcut icon" type="imagex/png" href="../../img/logo.png">
    <link rel="stylesheet" href="index.css">
    <link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Material+Symbols+Outlined:opsz,wght,FILL,GRAD@20..48,100..700,0..1,-50..200&icon_names=close,menu,personarrow_drop_downarrow_drop_up" />

    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="../../js/sessao.js"></script>
    
</head>

<body onload="validarSessao(), exibirFiliais()">
    <header class="menu">
        <div class="esquerda">
            <!-- <a href="home.html" style="text-decoration: none"> -->
                <span class="logo" style="cursor: default;">SafeWare</span>
            <!-- </a> -->
            <p class="titulo">Visão geral</p>
        </div>
        <div class="direita">
            <a onclick="clickOpcoes()" class="perfil" id="setaPerfil">
                <span class="material-symbols-outlined" id="setaMenu">
                    arrow_drop_down
                </span>
            </a>
        </div>
    </header>

    <div id="menuPerfil">
        <a onclick="limparSessaoComum()" style="border-radius: 0 0 1vh 1vh;">Sair</a>
    </div>

    <div id="cima">
        <div class="cimaEsq">
            <h1 id="bRestaurante">Empresa X</h1>
            <div>
                <span>Status geral</span>
                <p id="sttsVazamento">Sem vazamentos</p>
            </div>
        </div>
        <div class="cimaMeio">
            
        </div>
        <div class="cimaDir">
            <span>
                <b>Quantidade de filiais</b>
                <p id="qtdFiliais">0</p>
                <b>Quantidade de sensores</b>
                <p id="qtdSensores">0</p>
            </span>
            <canvas id="graficoGeral" height="300" width="800"></canvas>
        </div>
    </div>
    <div id="baixo">

    </div>

    <div id="alerta">
        <span class="card">
            <span id="closeAlerta" onclick="closeAlerta()" class="material-symbols-outlined">
                close
            </span>

            <img src='../../img/aviso.png'>
            <p class='atencao'>Um vazamento foi detectado!</p> 
            <p>O sensor do fogão 1 da filial 1 acabou de detectar um vazamento, tome já as providências necessárias para a segurança do seu estabelecimento.</p>
        </span>
    </div>

    <script data-jsd-embedded data-key="eb6df58d-df11-4966-8be2-7d3087316574" data-base-url="https://jsd-widget.atlassian.com" src="https://jsd-widget.atlassian.com/assets/embed.js"></script>

    <script>
        function clickMenu() {
            if (opcoes.style.left == '-300px') {
                opcoes.style.left = '0';
            } else {
                opcoes.style.left = '-300px';
            }
        }

        function clickOpcoes() {
            if (menuPerfil.style.top == '-5vw') {
                menuPerfil.style.top = '5vw';
                setaMenu.innerHTML = 'arrow_drop_up';
            } else {
                menuPerfil.style.top = '-5vw';
                setaMenu.innerHTML = 'arrow_drop_down';
            }
        }
    
        function clickClose() {
            endereco.style.right = '-620px';
        }

        function closeAlerta() {
            alerta.style.display = 'none';
        }

        function direcionarDash(idFilial){
            sessionStorage.setItem('idFilialAtual', idFilial);
            window.location = "dashboard.html";
        };

        function exibirFiliais() {
            JSON.parse(sessionStorage.FILIAIS).forEach(item => {
                document.getElementById("baixo").innerHTML += `
                    <a style="cursor: pointer;" onclick="direcionarDash(${item.idFilial})" class="cozinha" id="filial${item.idFilial}" style="text-decoration: none;">
                        <img src="../img/cozinhaSegura.png">
                        <h3 style="text-align: center;">Filial - ${item.endereco}</h3>
                    </a>        
                    `
            });
        }

        // ------------------- GRAFICO VISÃO GERAL ---------------------------------------

        var graficoGeral = document.getElementById('graficoGeral');

        var dadosGeral = ['Janeiro', 'Fevereiro', 'Março', 'Abril', 'Maio', 'Junho'];

        var configGeral = {
            responsive: false,
            type: 'bar',
            data: {
                datasets: [{
                    label: 'Filial 1',
                    data: [3, 1, 2, 3, 4, 6],
                    borderColor: '#6e65ec',
                    backgroundColor: '#6e65ec'
                },
                {
                    label: 'Filial 2',
                    data: [1, 2, 2, 5, 3, 2],
                    borderColor: '#36317a',
                    backgroundColor: '#36317a'
                },
                {
                    label: 'Total de vazamentos',
                    data: [4, 3, 4, 8, 7, 8],
                    backgroundColor: '#939399',
                    borderColor: '#939399'    
                }],
                labels: dadosGeral
            },
            options: {
                scales: {
                    y: {
                        beginAtZero: true
                    }
                }
            }
        }

        var chartGeral = new Chart (graficoGeral, configGeral);
    </script>
</body>
</html>
